{% extends 'layout/navbar.html' %}

{% block title %} Daftar Kategori {% endblock %}
{% load django_bootstrap5 %}
{% bootstrap_css %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/custom.css' %}">
<div class="container my-4">
  <h1 class="mb-4">Daftar Kategori</h1>
  <a href="{% url 'kategori_create' %}" class="btn btn-custom mb-3">Tambah Kategori</a>

  <form method="GET" action="{% url 'kategori_index' %}" class="d-flex mb-4">
    <input class="form-control me-2" type="search" name="q" placeholder="Cari kategori..." value="{{ query|default:'' }}" aria-label="Search">
    <button class="btn btn-outline-success btn-custom" type="submit">Cari</button>
  </form>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <div class="table-responsive">
    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
              <th>Nama Kategori</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody>
            {% for kategori in kategori_list %}
            <tr>
              <td>{{ kategori.nama }}</td>
              <td>
                <div class="d-flex">
                    <a href="{% url 'kategori_update' kategori.id %}" class="btn btn-sm btn-warning btn-sm-custom me-1">Ubah</a>
                    <button class="btn btn-sm btn-danger btn-sm-custom" onclick="confirmDelete({{ kategori.id }})">Hapus</button>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="2" class="text-center">Tidak ada data kategori</td>
            </tr>
            {% endfor %}
          </tbody>
    </table>
  </div>

  <script>
    function confirmDelete(kategoriId) {
      Swal.fire({
        title: 'Data kategori akan dihapus',
        text: 'Data tidak akan bisa dikembalikan!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Ya, Hapus!'
      }).then((result) => {
        if (result.isConfirmed) {
          // Mengirim permintaan AJAX untuk menghapus data
          fetch(`/kategori/delete/${kategoriId}/`, {
            method: 'POST',
            headers: {
              'X-CSRFToken': '{{ csrf_token }}'
            }
          }).then(response => {
            if (response.ok) {
              Swal.fire(
                'Deleted!',
                'Data kategori telah dihapus.',
                'success'
              ).then(() => {
                // Muat ulang halaman setelah penghapusan berhasil
                window.location.reload();
              });
            } else {
              Swal.fire(
                'Error!',
                'Terjadi kesalahan saat menghapus data.',
                'error'
              );
            }
          });
        }
      });
    }
  </script>
</div>
{% endblock %}
